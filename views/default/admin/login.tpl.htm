<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8" />
<meta name="renderer" content="webkit" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="referrer" content="no-referrer" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="blank" />
<meta name="format-detection" content="telephone=no" />
<title><?php echo $this->page_title; ?></title>

<link rel="stylesheet" href="<?php echo G_STATIC_URL; ?>/css/bootstrap.css" />
<link rel="stylesheet" href="<?php echo G_STATIC_URL; ?>/css/icon.css" />
<link rel="stylesheet" href="<?php echo G_STATIC_URL; ?>/admin/css/login.css?v=<?php echo G_DISPLAY_VERSION_BUILD; ?>" />

<?php if (is_array($this->_import_css_files)) { ?>
<?php foreach ($this->_import_css_files AS $import_css) { ?>
<link rel="stylesheet" href="<?php echo $import_css; ?>?v=<?php echo G_DISPLAY_VERSION_BUILD; ?>" />
<?php } ?>
<?php } ?>

<script type="text/javascript">
var G_BASE_URL = "<?php echo url_rewrite(); ?>";
</script>

<script src="<?php echo G_STATIC_URL; ?>/js/jquery.2.js"></script>
<script src="<?php echo G_STATIC_URL; ?>/js/bootstrap.js"></script>
<script src="<?php echo G_STATIC_URL; ?>/js/jquery.form.js"></script>
<script src="<?php echo G_STATIC_URL; ?>/js/hogan.js"></script>
<script src="<?php echo G_STATIC_URL; ?>/admin/js/framework.js"></script>
<script src="<?php echo G_STATIC_URL; ?>/admin/js/aws_admin.js?v=<?php echo G_DISPLAY_VERSION_BUILD; ?>"></script>
<script src="<?php echo G_STATIC_URL; ?>/admin/js/aws_admin_template.js?v=<?php echo G_DISPLAY_VERSION_BUILD; ?>"></script>
<script src="<?php echo G_STATIC_URL; ?>/admin/js/global.js?v=<?php echo G_DISPLAY_VERSION_BUILD; ?>"></script>

<?php if (is_array($this->_import_js_files)) { ?>
<?php foreach ($this->_import_js_files AS $import_js) { ?>
<script src="<?php echo $import_js; ?>?v=<?php echo G_DISPLAY_VERSION_BUILD; ?>"></script>
<?php } ?>
<?php } ?>
</head>

<body>
<div class="aw-login">
	<div class="mod center-block">
		<h1><img src="<?php echo G_STATIC_URL; ?>/admin/img/wecenter-logo.png" alt="" /></h1>

		<form id="login_form" onsubmit="return false" method="post">
			<div class="alert alert-danger collapse error_message"></div>
			<div class="form-group">
				<label><?php echo _t('用户名'); ?></label>
				<input type="text" class="form-control" name="username" autocomplete="username" value="<?php echo UF::name($this->user_info); ?>" readonly />
				<i class="icon icon-user"></i>
			</div>
			<div class="form-group">
				<label><?php echo _t('密码'); ?></label>
				<input type="password" class="form-control" name="password" autocomplete="current-password" placeholder="<?php echo _t('密码'); ?>" autofocus />
				<i class="icon icon-lock"></i>
			</div>

			<button type="submit" class="btn btn-primary"><?php echo _t('登录'); ?></button>
		</form>

		<h2 class="text-center aw-small-text">WeCenter Admin Control</h2>
	</div>
</div>



<script type="text/javascript">
$(document).ready(function () {
	var form = $('#login_form');

	form.submit(function(e) {
		e.preventDefault();

		var pwd = form.find('input[name=password]').val();
		var client_salt = '<?php echo $this->user_info['salt']; ?>';
		var password_version = (<?php echo intval($this->user_info['password_version']); ?> || 1);

		var new_form = $('<form>', {action: '<?php echo url_rewrite(); ?>/admin/ajax/login_process/', method: 'post'});

		PasswordUtil.password_hash(pwd, client_salt, password_version).then(function(value) {
			new_form.append($('<input>', {name: 'scrambled_password', value: value}));
			AWS.ajax_post(new_form, AWS.ajax_processer, 'error_message');
		}).catch(function(error) {
			console.log(error);
			alert("<?php echo _t('发生错误'); ?>");
		});

		return false;
	});
});
</script>

</body>
</html>